<!DOCTYPE html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta charset="utf-8">
  <title>Signature</title>
  <meta name="description" content="Signature Pad - HTML5 canvas based smooth signature drawing using variable width spline interpolation.">

  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <link rel="stylesheet" href="stylesign.css">
    <link rel="stylesheet" href="print.css">

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39365077-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>
<body onselectstart="return false">
  <div id="signature-pad" class="m-signature-pad">
    <div class="m-signature-pad--body">
      <canvas></canvas>
    </div>
    <div class="m-signature-pad--footer">
      <div class="description">Please Sign above</div>
      <div class="left">
        <button type="button" id="clear" class="btn btn-primary btn-lg" data-action="clear">Clear</button>
      </div>
      <div class="right">
        <button type="button" id="save" class="btn btn-primary btn-lg" data-action="save-png">Save</button>
      </div>
    </div>
  </div>

  <!--<script src="js/signature_pad.js"></script>-->
  <script type="text/javascript">
      var str;
    var wrapper = document.getElementById("signature-pad"),
    clearButton = wrapper.querySelector("[data-action=clear]"),
    savePNGButton = wrapper.querySelector("[data-action=save-png]"),
    saveSVGButton = wrapper.querySelector("[data-action=save-svg]"),
    canvas = wrapper.querySelector("canvas"),
    signaturePad;

// Adjust canvas coordinate space taking into account pixel ratio,
// to make it look crisp on mobile devices.
// This also causes canvas to be cleared.
function resizeCanvas() {
    // When zoomed out to less than 100%, for some very strange reason,
    // some browsers report devicePixelRatio as less than 1
    // and only part of the canvas is cleared then.
    var ratio =  Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
}

window.onresize = resizeCanvas;
resizeCanvas();

signaturePad = new SignaturePad(canvas);

clearButton.addEventListener("click", function (event) {
    signaturePad.clear();
});

savePNGButton.addEventListener("click", function (event) {
    if (signaturePad.isEmpty()) {
        alert("Please provide signature first.");
    } else {
 str = signaturePad.toDataURL();
        upload();
}

});
    
 function  upload() {
       var today = new Date();
var dd = today.getDate();
var mm = today.getMonth()+1; //January is 0!
var yyyy = today.getFullYear();

if(dd<10) {
    dd='0'+dd
} 

if(mm<10) {
    mm='0'+mm
} 

today = dd+'/'+mm+'/'+yyyy;
     
      var Tname = sessionStorage.getItem('name');
     var debits = sessionStorage.getItem('Mtotal');
     var receipt = sessionStorage.getItem('receipt');
     var group = sessionStorage.getItem('group');
     
     
     document.getElementById('clear').style.visibility = 'hidden';
     document.getElementById('save').style.visibility = 'hidden';
          var imageCode = str;

 Parse.initialize("5uHe6i4aZsLeX0XScouI6lHiPQ2nMeWkzieKMgj7", "wZH4mQq7uK1HpmgWI5lGCXTwDwrvJ8syTC01UGjN");
	 Parse.serverURL = 'https://parseapi.back4app.com'; 
      var current = Parse.User.current();
var Sname = current.get("firstname");
var signupload = Parse.Object.extend("account");
var signUpload = new signupload();
signUpload.set("date", today);
signUpload.set("trans", Tname);
signUpload.set("debits", debits);
signUpload.set("receiptnumber", receipt);
signUpload.set("credit", "0.00");
signUpload.set("group", group);  
signUpload.set("signFileUrl", str);
signUpload.set("staff", Sname);
signUpload.set("paid", false);
signUpload.save(null, {
  success: function(signUpload) {
      sessionStorage.clear();
      //print();
      alert("Done");
      window.location.href = "invoice.html";
  }
});
     
      }
      
      function print() {
   var DocumentContainer = document.getElementById("example-print");
    var WindowObject = window.open('', 'PrintWindow', 'width=750,height=650,top=50,left=50,toolbars=no,scrollbars=yes,status=no,resizable=yes');
      var str = "<style type='text/css' href='css/print.css'>";
            str = str + "</style>";
            WindowObject.document.writeln(str);
   WindowObject.document.writeln(DocumentContainer.innerHTML);
  
  
    WindowObject.document.close();
    WindowObject.focus();
    WindowObject.print();
    WindowObject.close();
        var q1 = sessionStorage.getItem('q1');
        var q2 = sessionStorage.getItem('q2');
        var q3 = sessionStorage.getItem('q3');
        var q4 = sessionStorage.getItem('q4');
        var q5 = sessionStorage.getItem('q5');
        var select1 = sessionStorage.getItem('select1');
        var select2 = sessionStorage.getItem('select2');
        var select3 = sessionStorage.getItem('select3');
        var select4 = sessionStorage.getItem('select4');
        var select5 = sessionStorage.getItem('select5');
        var total1 = sessionStorage.getItem('total1');
        var total2 = sessionStorage.getItem('total2');
        var total3 = sessionStorage.getItem('total3');
        var total4 = sessionStorage.getItem('total4');
        var total5 = sessionStorage.getItem('total5');
          
          document.getElementById("qan1").innerHTML = q1;
    document.getElementById("qan2").innerHTML = q2;
    document.getElementById("qan3").innerHTML = q3;
    document.getElementById("qan4").innerHTML = q4;
           document.getElementById("qan5").innerHTML = q5;
          
           document.getElementById("selected1").innerHTML = select1;
          document.getElementById("selected2").innerHTML = select2;
          document.getElementById("selected3").innerHTML = select3;
          document.getElementById("selected4").innerHTML = select4;
          document.getElementById("selected5").innerHTML = select5;
          
          document.getElementById("totals1").innerHTML = total1;
          document.getElementById("totals2").innerHTML = total2;
          document.getElementById("totals3").innerHTML = total3;
          document.getElementById("totals4").innerHTML = total4;
          document.getElementById("totals5").innerHTML = total5;
      }
        </script>
    <div id="example-print">
<p id="qan1" class="qan1">Sorry No Data Found</p>
<p id="qan2" class="qan2">Sorry No Data Found</p>
<p id="qan3" class="qan3">Sorry No Data Found</p>
<p id="qan4" class="qan4">Sorry No Data Found</p>
        <p id="qan5" class="qan5">Sorry No Data Found</p>
<p id="selected1" class="selected1">Sorry No Data Found</p>
<p id="selected2" class="selected2">Sorry No Data Found</p>
<p id="selected3" class="selected3">Sorry No Data Found</p>
<p id="selected4" class="selected4">Sorry No Data Found</p>
<p id="selected5" class="selected5">Sorry No Data Found</p>
<p id="totals1" class="totals1">Sorry No Data Found</p>
<p id="totals2" class="totals2">Sorry No Data Found</p>
        <p id="totals3" class="totals3">Sorry No Data Found</p>
        <p id="totals4" class="totals4">Sorry No Data Found</p>
        <p id="totals5" class="totals5">Sorry No Data Found</p>
    </div>
</body>
</html>